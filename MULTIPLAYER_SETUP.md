# 多人對戰功能設置指南

## 概述

本項目已實現完整的多人對戰功能，包括：
- 實時Socket.IO連接
- 房間創建和管理
- 快速匹配系統
- 遊戲狀態同步
- 攻擊系統（垃圾行）
- 聊天功能

## 本地開發設置

### 1. 安裝依賴

所有必要的依賴已經安裝，包括：
- `socket.io` - 服務器端Socket.IO
- `socket.io-client` - 客戶端Socket.IO
- `express` - Web服務器框架
- `cors` - 跨域資源共享

### 2. 環境變數配置

已創建 `.env` 文件，包含以下配置：

```env
# Socket.IO 服務器配置
VITE_SOCKET_URL=ws://localhost:3001
```

### 3. 啟動服務器

#### 方法1：分別啟動前後端

```bash
# 終端1：啟動Socket.IO服務器
npm run server

# 終端2：啟動前端開發服務器
npm run dev
```

#### 方法2：同時啟動前後端

```bash
# 同時啟動前後端服務器
npm run dev:full
```

### 4. 測試連接

1. 打開瀏覽器訪問 `http://localhost:5173`（或顯示的端口）
2. 登入或使用訪客模式
3. 點擊「多人對戰」
4. 查看連接狀態應顯示為「已連接」

## 功能說明

### 快速匹配
- 點擊「開始匹配」自動尋找對手
- 系統會自動創建房間並開始遊戲

### 房間系統
- 創建自定義房間
- 瀏覽可用房間列表
- 房主控制遊戲開始

### 遊戲功能
- 實時遊戲狀態同步
- 攻擊系統（消除2行以上發送垃圾行給對手）
- 聊天功能
- 遊戲結束判定

## Zeabur 雲端部署

### 1. 準備部署

已創建 `zeabur.json` 配置文件，包含前後端部署設置。

### 2. 部署步驟

1. **創建Zeabur項目**
   - 訪問 [Zeabur](https://zeabur.com)
   - 創建新項目
   - 連接您的GitHub倉庫

2. **部署後端服務器**
   - 創建新服務
   - 選擇Node.js環境
   - 設置啟動命令：`node server.js`
   - 設置環境變數：
     ```
     NODE_ENV=production
     PORT=3001
     ```

3. **部署前端應用**
   - 創建新服務
   - 選擇靜態網站
   - 設置構建命令：`npm run build`
   - 設置輸出目錄：`dist`
   - 設置環境變數：
     ```
     VITE_SOCKET_URL=wss://your-backend-domain.zeabur.app
     ```

### 3. 域名配置

1. 獲取後端服務域名（例如：`tetris-server.zeabur.app`）
2. 更新前端環境變數中的 `VITE_SOCKET_URL`
3. 確保使用 `wss://` 協議（安全WebSocket）

### 4. 驗證部署

1. 訪問前端域名
2. 測試多人對戰功能
3. 檢查服務器統計：`https://your-backend-domain.zeabur.app/stats`

## 服務器API端點

### 健康檢查
```
GET /health
```
返回服務器狀態、房間數量、玩家數量等信息。

### 統計信息
```
GET /stats
```
返回詳細的服務器統計信息，包括所有房間和玩家狀態。

## 故障排除

### 連接問題

1. **本地開發**
   - 確保Socket.IO服務器在端口3001運行
   - 檢查防火牆設置
   - 確認 `.env` 文件配置正確

2. **生產環境**
   - 確認域名配置正確
   - 檢查HTTPS/WSS協議
   - 驗證CORS設置

### 常見錯誤

- **「無法連接到遊戲服務器」**：檢查服務器是否運行，端口是否正確
- **房間創建失敗**：確認用戶已登入，Socket連接正常
- **匹配超時**：檢查是否有其他玩家在線

## 開發說明

### 服務器架構

- 使用Express.js作為HTTP服務器
- Socket.IO處理實時通信
- 內存存儲房間和玩家狀態
- 支持房間管理、匹配系統、遊戲同步

### 客戶端架構

- Zustand狀態管理
- Socket.IO客戶端連接
- React組件化UI
- TypeScript類型安全

### 擴展功能

可以考慮添加的功能：
- 數據庫持久化
- 用戶排行榜
- 觀戰模式
- 重播系統
- 更多遊戲模式

## 支持

如果遇到問題，請檢查：
1. 服務器日誌
2. 瀏覽器控制台
3. 網絡連接狀態
4. 環境變數配置

多人對戰功能現已完全可用！🎮